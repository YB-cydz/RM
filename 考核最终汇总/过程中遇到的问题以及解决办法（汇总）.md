### 雷达导航

#### 1.不知道urdf是什么

通过gpt给出的示例，明白urdf是一种描述机器人结构的参数文件，同时大概了解urdf怎么写（跟xml很想）

#### 2.完成urdf文件后，不知道怎么在rviz上显示

借助gpt学会通过`file`打开的方式可视化，gpt还给出了通过robot_state_publisher发布urdf文件，但是我在rviz中将source从file改为topic后并没有看见圆柱，然而我确认了`/robot_description`话题有正确urdf的内容，以及tf输出正确，其他的暂时没有思路。（又经过一番探索后找到了`Description Topic`的选项，选择`/robot_description`成功显示）

#### 3.直接在命令行使用`ros2 run robot_state_publisher robot_state_publisher --ros-args   -p robot_description:=`，报错显示无法加载太大的urdf

通过gpt知道可以通过launch文件启动解决

#### 4.无法显示完整的小车，只能看到一个圆柱体

gpt无法解决，遂上csdn找文档。只需将`rviz`中`Global Options `→ `Fixed Frame` 设置为 `base_link`

#### 5.`rviz`中少看到两个轮子

前往csdn找别人写的launch，发现有人的launch里面还用了`joint_state_publisher_gui`，加上之后就能显示完整小车了

#### 6.不会使用rqt查看tf

问gpt。我先将`rqt -h`的内容粘给他看，然后看完他的解释感觉`rqt -h`没有我想要的。于是我直接问他`ros2 利用rqt查看tf树`，然后跟着步骤安装了ROS2 的 `rqt_tf_tree` 插件后打开rqt并在 `Plugins` 菜单下选择 `Visualization` → `TF Tree` 后成功看到tf树

#### 7.tf树不完整，少了两个轮子

检查`urdf`确认有从`base_link`到`wheek`的`joint`

询问gpt后发现是因为urdf文件中有的注释使用了`#`，而这是不规范的，导致有些东西没被正确加载，删除这些注释之后重新编译运行后得到完整的tf。这确实说明了在 URDF 里不能用 `#` 注释，它会被解析器当成错误字符，导致后续的 `<joint>` 没有被正确加载。

---

### 自瞄

#### 1.不了解自瞄系统怎么设计

由于事先对自瞄这块了解不多，所以我先上了csdn找别人的开源项目，然后终于在一大堆源码（基本不讲思路）的文档中发现了吉大在github中开源项目的传送门，通过阅读readme文档，我对他们的视觉方案有了一定了解，然后就以借鉴他们的思路为主的同时填充了一点点我从别的文档看到的一些可能需要的小细节

#### 2.每帧只框出一个虚拟装甲板

检查代码发现函数中return写for循环里面了。。。

#### 3.不会用solvepnp

初次使用solvepnp，通过gpt知道输入包含参考尺寸，图像坐标，相机内参，畸变参数，输出是目标相对于相机的位置（旋转向量和平移向量，这个平移向量就是我们要的目标在相机坐标系中的3d坐标），在这里我对参考尺寸的坐标系选取产生疑惑（gpt用z=0），我想这装甲板一般是立起来的（是不是该用y=0），gpt就告诉我输出确实不一样，但是实际上只是坐标轴（用z=0得到的z最后是向前的）不同，于是我到csdn上查找机器人常用的坐标系，最后选择使用基坐标系（前x，左y，上z），然后gpt告诉我相机坐标系默认是x右, y下, z前，只需要再进行一次矩阵变换（交换xyz的方向）就能得到我想要的坐标系（这里还是以相机作为坐标系原点）

#### 4.有时候会多识别很多装甲板（闪过去的编号甚至达到了4）

增加了一个判断，过滤掉面积小的轮廓防止误识别

#### 5.能量机关识别没有思路

github源码太多英文不好，不方便直接找到相应的源码，于是到scdn上找,随后大概有了思路之后开始尝试，总之主要是参照里面的文档来的。

然而第一步的二值化就弄半天没找到合适的上下限（随机截图取帧后通过滑块调节，但是取了几个不同的帧找到合适上下限之后用在视频的效果不是很理想），于是再次开始找源码借鉴其他思路

最后是以通道相减法二值化后的`mask_diff` 与hsv上下限得到的`mask_hsv`（只取比较亮的部分）取交集勉强得到一个能看的轮廓。

关于待打击扇叶，根据文档，我选取了没有父轮廓和子轮廓的轮廓中面积最大的那个作为待打击扇叶，根据可视化结果基本上能对的上，可是由于预处理没做好，导致他的轮廓有时会跟别的连到一起，这使得视频中间用黄色圈起来的会有不止一个

关于待打击位置，我是按照将待打击扇叶几何中心与R（能量机关中心）的连线反向延长去找的靶子的中心，其中R是用没有父轮廓和子轮廓的轮廓中面积最小的那个。开始的时候我是将R固定在第一帧出现的位置，发现R的位置有变化之后我尝试去动态追踪R，但是效果不好（R有时候会乱动甚至跑到扇叶上，我认为还是预处理的问题），最后就将他固定在第一帧的位置了。另外待打击位置乱动的原因除了R的位置不准以外，还有轮廓有时候会连在一起的原因

判断是否处于激活状态我是通过检测还有没有待击扇叶来判断的

最后整完了大概之后再次尝试调节hsv，经过半小时努力后优化了一点点，勉强能中3个了

总之，我觉得问题主要在预处理，要是预处理能做好大概就完美了（要说算法，虽然糙了一些但大概是够用的，但是这个预处理我只能说是尽力了，我看到的文档里面理想的预处理只有扇叶和中心的（仿真），但是我是真调不出来了）

有想过是不是能用深度学习试一下，但是苦于没有数据集而且想早点完成，遂放弃

---

### 三选一（选的雷达导航）

#### 1.配置环境出现依赖安装失败

我先跟着文档中环境配置的步骤走，然后在`rosdep install`这一步出现问题。有些依赖安装失败，通过使用`sudo apt update`后再次运行后成功。

#### 2.不清楚如何使用rviz让小车在gazebo上动起来

我看到模拟器的文档中有键盘控制的小工具，以为就是用键盘控制模拟的小车就行，然后回去查看考核要求时发现要用rviz手动控制，回想到之前好像从哪个视频看到别人在rviz上点一下，小车就过去了，我就也随便点了个地方结果毫无反应，然后我就随便看看rviz的面板，然后发现上面有一栏东西，尝试使用`Publish Point`（我以为是发送目标点）选项并点击之后还是没反应，然后再使用`Nav2 Goal`（感觉是指定导航目标的意思）后小车终于动了