# 视觉组考核

## 写在前面：

对于考核内容，“点击就送”是几乎不可能的，在这过程中你可能会遇到各种各样的问题，有些问题你可能很难解决，但是考核时间有限，**所以你不必追求一定要实现最终的目标**。在完成考核任务的过程中，你遇到了哪些问题，其中，你解决了什么问题，你是如何解决的，哪些问题没有解决，你觉得可能的原因是什么，**请列写一份文档**，用你觉得我们看得懂的格式记录一下这个过程。相比于最终的结果，**这份文档是我们考核的关键**，你可以一边记录一边完成而不是等到最后一起总结。

祝你好运！

## 雷达导航

### 一、我们在培训的过程中多次提到imu这个硬件，相信大家现在对于imu的概念也有了初步的了解。请你回忆培训中的内容并查阅资料，回答以下问题：

1.**简要**叙述一下**imu的工作原理**；

2.从imu的工作原理出发，推导出如何通过imu获取机器人的实时位姿；**位姿获取**

3.在雷达导航中，imu是一个不可或缺的硬件，为什么我们有了雷达精准的重定位功能还需要imu，请分点**指出imu的重要作用**（可以从建图，定位，导航分别思考）。



### 二、在培训过程中我们花了一定的篇幅介绍了tf坐标变换以及tf树的概念，现在轮到你来尝试构建一棵tf树了，请你查阅相关资料，完成以下任务：

1.在ros2环境中尝试**发布从base_link到imu_link的tf坐标变换**，具体的数值可自行设定，请使用可视化工具**rqt绘制出tf，并截图粘贴出来**；

2.请你查阅资料**了解rviz**这个强大的工具，**尝试使用urdf文件绘制一个白色圆柱体**，具体的数值可自行设定，**将结果在rviz中可视化并截图粘贴出来**；

3.在问题二的基础上，请为这个白色圆柱体**添加其余部件（必须包含雷达和imu），使之成为一个两轮差速小车，将结果在rviz中可视化并截图粘贴出来**；

4.请你查阅资料**了解robot_state_publisher这个功能包的作用**，尝试将在问题三中构建的两轮差速小车的各个部分之间的**tf转换发布出来**，如果一切顺利的话，你应该可以从rqt中看到一棵**静态的tf树，包含base_link,lidar_link,imu_link等坐标系（具体的名称可以不一样），请将其截图粘贴出来，同时将你的urdf文件一并上传**。



## 自瞄

### 一、自瞄装甲板逻辑设计

假设，现在你手里有一辆步兵机器人，其功能包括但不限于上下位机通信、云台转动（yaw轴）、枪口抬降（pitch轴）全部实现，仅车载 MiniPC 上缺少一套自瞄系统。搭载的设备包括但不限于一套工业相机+镜头，一个性能充沛的 MiniPC，一个正常工作的 IMU

现在，请你借助网上的已开源资料并结合自己的思考，**使用==流程框图==设计一个运行在 MiniPC 上的自瞄系统**，帮助这台步兵**实现自动瞄准敌方装甲板的功能**。

**任务概述**

- 系统输入：工业相机图片流（固定于云台上）；云台 IMU 数据；弹丸初始射速；我方颜色。
- 系统输出：云台目标 yaw、pitch 角度。
- 运算设备：Jetson Orin NX 边缘运算设备。

### 二、识别题

**1.能量机关**

能量机关机制是超级对抗赛的重要机制之一，成功开启能量机关可为队伍获得巨大收益（见参考资料），然而其对击打精度和速度的限制使人工手瞄变得困难，因此，能量机关自瞄也是我们的工作之一。

请你根据能量机关机制编写程序**识别其待击打位置（不限传统方法or神经网络）**，同时要求能**判断出能量机关是否处于激活状态**，扇叶为待击打态or已击打态。**请使用我们提供的视频作为测试demo，录制可视化结果**。（视频资料见附件）

参考资料：

[RoboMaster 2025 机甲大师超级对抗赛比赛规则手册V2.1.0（20250802）.pdf](https://terra-1-g.djicdn.com/b2a076471c6c4b72b574a977334d3e05/RM2025/RoboMaster 2025 机甲大师超级对抗赛比赛规则手册V2.1.0（20250802）.pdf)

**2.装甲板识别与位姿解算**

请你**根据我们提供的虚拟简化版装甲板小陀螺视频，完成对装甲板的识别并利用solvepnp完成其位姿的解算，录制可视化结果**。（视频资料见附件）

参数：

* 虚拟装甲板长宽：14cm×12cm

* 相机内参矩阵：

```
K = [1000.0    0    500.0]
       [   0   1000.0  350.0]
       [   0      0      1  ]
```

**可视化要求：**

* **画出装甲板外接矩形框与中心点**
* **在左上角显示装甲板中心点在相机坐标系下的xyz坐标（如识别到多块则全部列出）**



## 选择性完成以下题目（三选一）

如果你的意向是进入自瞄组，请在1、2两问中选一问完成；如果你想做雷达导航，请完成第3问

### 1.小陀螺状态下的装甲板运动预测

运动学预测是自瞄非常重要的一环，培训时我们已经向大家介绍了卡尔曼滤波器这一个工具，是时候在实际任务中运用一下了。

小陀螺常规理想状态下为匀速转动，但在实际情况中转速会存在一定的噪声，因此我们提供的模拟视频中，稳定状态下的转速也存在噪声。在第二题中你已经完成了对装甲板中心点的位姿结算，现在请你编写程序实现预测 **t** ms后距离机器人最近的一块装甲板中心点的位置，并录制可视化结果。（视频沿用第二题）

测试参数：t = 40；t = 15

**可视化要求：**

* 仅标出距离机器人最近的一块装甲板中心点，并用不同颜色标出 **t** ms后的预测位置

### 2.大能量机关非线性旋转预测

在第二题中你已经阅读了能量机关的相关机制，并完成了识别部分。现在，不考虑位姿解算的部分，假设机器人正对大能量机关，到所有扇叶的距离均为相同定值，仅在图像坐标系（或者像素坐标系）上做分析。请你根据规则文档对大能量机关的转速定义，编写程序实现预测大能量机关待击打点120ms后的位置，并录制可视化结果。

**可视化要求：**

* 框出待击打扇叶，标出识别到的待击打点，并用不同颜色标出120ms后的预测位置

**难度增减项：**

1. 如果你认为识别效果不好或者全流程预测过于困难，请你简化仿真单片扇叶在合理参数下旋转情况，并做出预测
   *  在录制的视频中更改2次你设置的速度参数

2. 如果你认为仅一个大能量机关的视频并不能体现你的代码鲁棒性，请你简化仿真大能量机关击打的全流程，并作出预测，额外提交一份视频
   * 在视频中展示随机设置速度参数与待击打扇叶的代码部分
   * 运行两次你的程序

注：

* 在难度增减项中对简化模型不做限制，你觉得是一个合理的简化即可
* 仿真≠matlab；能完成可视化显示即可，不限制工具类型

### 3、请在完成雷达导航前两问的前提下开始完成第三问：

有些时候因为种种原因，我们没有实车提供给我们进行导航的调试，这会影响我们的测试进度。幸运的是，ros2为我们提供了仿真平台，可以让我们对于一些构想进行初步的测试。对于robomaster比赛，深圳北理莫斯科北极熊战队开源了他们的模拟器[pb_rm_simulation](https://github.com/LihanChen2004/pb_rm_simulation)用于模拟rm赛场并进行仿真调试。现在，请你**尝试将这个模拟器部署到你的电脑上**，如果一切顺利的话，**你应该可以在rviz中手动指定导航目标点，并在gazebo中观察到小车开始移动，也即小车成功实现了自主导航移动**。**请从输入命令的时候开始录制视频，将上述过程录制进入视频中，同时打开rqt查看tf树，最后将视频压缩上传**。（Ubuntu系统原生的录屏似乎不支持MP4格式，所以请在上传的时候一并指出视频格式，**上传之前使用windows网页查看一遍视频确保不是黑屏**。强烈不推荐使用手机拍屏，如果实在需要拍屏，请务必确保拍摄的清晰程度，这可能会影响到你的考核成绩）

